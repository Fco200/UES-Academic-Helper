<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso Universitario | UES Helper</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --ues-guinda: #800000; --ues-oro: #FFD700; --bg-dark: #050505; }
        
        body { 
            background: radial-gradient(circle at top right, #1a0000, var(--bg-dark));
            height: 100vh; display: flex; align-items: center; justify-content: center;
            font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; color: white;
            overflow: hidden;
        }

        #particles-js { position: absolute; width: 100%; height: 100%; z-index: 1; }

        .login-container {
            background: rgba(15, 15, 15, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 35px;
            width: 100%; max-width: 420px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
            position: relative; z-index: 10;
        }

        .brand-title { font-weight: 800; font-size: 2rem; letter-spacing: -1px; margin: 0; }
        .brand-title span { color: var(--ues-guinda); }

        .form-label { font-size: 0.7rem; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display: block; }
        
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            border-radius: 12px; padding: 12px 18px;
            transition: 0.3s; margin-bottom: 20px;
        }

        .btn-main {
            background: var(--ues-guinda);
            border: none; border-radius: 12px;
            padding: 16px; width: 100%;
            font-weight: 700; color: white;
            transition: 0.4s; text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center;
        }

        .btn-main:hover { background: #a00000; transform: translateY(-2px); }

        /* NOTIFICACIÓN FLOTANTE MEJORADA */
        .floating-toast {
            position: fixed; top: 20px; right: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(10px);
            color: white; padding: 15px 25px;
            border-radius: 15px; border-left: 5px solid var(--ues-guinda);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000; display: none;
            animation: slideIn 0.5s forwards;
            font-size: 0.85rem; font-weight: 600;
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .step { width: 12px; height: 12px; border-radius: 50%; background: rgba(255,255,255,0.1); transition: 0.4s; }
        .step.active { background: var(--ues-guinda); transform: scale(1.2); }

        .version-tag { 
    opacity: 0.6; 
    font-size: 0.7rem; 
    margin-top: 30px; 
    border-top: 1px solid rgba(255,255,255,0.05); 
    padding-top: 15px; /* Reemplazo correcto de pt-3 */
}
    </style>
</head>
<body>

    <div id="particles-js"></div>
    <div id="errorToast" class="floating-toast"></div>

    <div class="login-container">
        <div class="brand-header text-center mb-4">
            <h1 class="brand-title">UES <span>HELPER</span></h1>
            <p class="text-muted small fw-bold">Portal Académico Multiversidad</p>
        </div>

        <div class="step-indicator d-flex justify-content-center mb-4">
            <div id="dot1" class="step active mx-1"></div>
            <div id="dot2" class="step mx-1"></div>
        </div>

        <div id="paso1">
            <div class="mb-3">
                <label class="form-label">Institución Universitaria</label>
                <select id="uniInput" class="form-select" onchange="actualizarCarreras()">
                    <option value="" disabled selected>Selecciona Universidad</option>
                    <option value="UES">Universidad Estatal de Sonora</option>
                    <option value="UNISON">Universidad de Sonora</option>
                    <option value="ITH">Tecnológico de Hermosillo</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="form-label">Carrera / Programa</label>
                <select id="carreraInput" class="form-select">
                    <option value="">Esperando universidad...</option>
                </select>
            </div>
            <button onclick="validarYPasar()" class="btn-main">Siguiente <i class="fas fa-chevron-right ms-2"></i></button>
        </div>

        <div id="paso2" style="display:none;">
            <div class="text-center mb-4">
                <span id="infoCarreraSeleccionada" class="badge bg-dark text-warning py-2 px-3 rounded-pill border border-warning shadow-sm"></span>
                <button class="btn btn-link btn-sm text-muted text-decoration-none d-block mt-2 mx-auto" onclick="regresar()">
                    <i class="fas fa-arrow-left me-1"></i> Cambiar carrera
                </button>
            </div>
            <div class="mb-3">
                <label class="form-label">Correo Institucional</label>
                <input type="email" id="emailInput" class="form-control" placeholder="usuario@ues.mx">
            </div>
            <div class="mb-4">
                <label class="form-label">Contraseña de Acceso</label>
                <input type="password" id="passInput" class="form-control" placeholder="••••••••">
                <div class="text-end mt-2">
                    <a href="recuperar.html" class="text-warning small fw-bold text-decoration-none">¿Olvidaste tu contraseña?</a>
                </div>
            </div>
            <button onclick="entrar()" class="btn-main">Ingresar al Portal <i class="fas fa-sign-in-alt ms-2"></i></button>
        </div>

        <div class="version-tag text-center pt-3">
            <p class="m-0">Versión 1.2.4 - Build 2026</p>
            <p class="m-0 text-danger fw-bold">Developer: Francisco Aguayo</p>
            <p class="small mb-0 mt-2">© 2026 UES Academic Helper</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        particlesJS("particles-js", {"particles":{"number":{"value":50},"color":{"value":"#800000"},"shape":{"type":"circle"},"opacity":{"value":0.3},"size":{"value":2},"line_linked":{"enable":true,"distance":150,"color":"#800000","opacity":0.2,"width":1},"move":{"enable":true,"speed":1.5}}});

        const oferta = {
            "UES": [
                "Ingeniería en Software", "Ingeniería Mecatrónica", "Ingeniería Industrial en Manufactura",
                "Ingeniería en Horticultura", "Ingeniería en Geociencias", "Ingeniería Ambiental",
                "Lic. en Administración de Empresas", "Lic. en Derecho", "Lic. en Criminalística",
                "Lic. en Enfermería", "Lic. en Nutrición Humana", "Lic. en Fisioterapia",
                "Lic. en Agronegocios", "Lic. en Comercio Internacional", "Lic. en Contaduría"
            ],
            "UNISON": [
                "Lic. en Medicina", "Lic. en Derecho", "Lic. en Psicología", "Lic. en Comunicación",
                "Ingeniería Civil", "Ingeniería Industrial", "Ingeniería de Minas", "Ingeniería Química",
                "Lic. en Arquitectura", "Lic. en Contaduría Pública", "Lic. en Informática",
                "Lic. en Enfermería", "Lic. en Biología", "Lic. en Física"
            ],
            "ITH": [
                "Ingeniería Sistemas Computacionales", "Ingeniería Mecatrónica", "Ingeniería Industrial",
                "Ingeniería Electrónica", "Ingeniería Eléctrica", "Ingeniería Mecánica",
                "Ingeniería en Gestión Empresarial", "Ingeniería Biomédica", "Ingeniería Aeronáutica"
            ]
        };

        function showToast(msg) {
            const t = document.getElementById('errorToast');
            t.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i> ${msg}`;
            t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 4000);
        }

        function actualizarCarreras() {
            const uni = document.getElementById('uniInput').value;
            const select = document.getElementById('carreraInput');
            if(!uni) return;
            select.innerHTML = oferta[uni].map(c => `<option value="${c}">${c}</option>`).join('');
        }

        function validarYPasar() {
            const uni = document.getElementById('uniInput').value;
            const carrera = document.getElementById('carreraInput').value;
            if(!uni || !carrera || carrera.includes("Esperando")) return showToast("⚠️ Selecciona universidad y carrera");
            
            document.getElementById('infoCarreraSeleccionada').innerText = carrera;
            document.getElementById('paso1').style.display = 'none';
            document.getElementById('paso2').style.display = 'block';
            document.getElementById('dot1').classList.remove('active');
            document.getElementById('dot2').classList.add('active');
        }

        function regresar() {
            document.getElementById('paso2').style.display = 'none';
            document.getElementById('paso1').style.display = 'block';
            document.getElementById('dot2').classList.remove('active');
            document.getElementById('dot1').classList.add('active');
        }

        async function entrar() {
            const btn = document.querySelector('#paso2 .btn-main');
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();
            
            if(!email || !pass) return showToast("⚠️ Ingresa tus credenciales");

            const originalText = btn.innerHTML;
            btn.innerHTML = `<i class="fas fa-circle-notch fa-spin me-2"></i> Validando...`;
            btn.disabled = true;

            // ACCESO MAESTRO (FRANCISCO)
            if (email === "franciscoaguayo2005@gmail.com" && pass === "VILLA1") {
                btn.innerHTML = `<i class="fas fa-crown me-2"></i> Bienvenido, Francisco`;
                btn.style.background = "#b8860b";
                localStorage.setItem('userEmail', email);
                setTimeout(() => { window.location.href = "/home.html"; }, 1500);
                return;
            }

            try {
                const res = await fetch('/verificar-codigo', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ email, codigo: pass })
                });
                
                const data = await res.json();
                if(res.ok) {
                    btn.innerHTML = `<i class="fas fa-check-circle me-2"></i> ¡Acceso Correcto!`;
                    btn.style.background = "#28a745";
                    localStorage.setItem('userEmail', email);
                    setTimeout(() => { window.location.href = data.redirect; }, 1500);
                } else {
                    showToast("❌ Acceso Denegado: Revisa tus datos.");
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            } catch (e) {
                showToast("❌ Error de servidor. Intenta de nuevo.");
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        document.getElementById('passInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') entrar(); });
    </script>
</body>
</html>