<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soporte y Opiniones | UES Helper</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --ues-guinda: #800000; --ues-oro: #FFD700; --sidebar-w: 280px; }
        body { 
            background: #000; color: #eee; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0;
            background-image: radial-gradient(circle at top right, #1a0000, #000);
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar { width: var(--sidebar-w); background: rgba(15,15,15,0.98); border-right: 1px solid rgba(128,0,0,0.3); height: 100vh; position: fixed; padding: 30px 20px; z-index: 1000; }
        .main-content { margin-left: var(--sidebar-w); padding: 50px; }
        
        /* Nav */
        .nav-link-custom { color: #888; padding: 12px; border-radius: 12px; display: block; text-decoration: none; margin-bottom: 10px; transition: 0.3s; }
        .nav-link-custom:hover { background: rgba(128,0,0,0.1); color: white; transform: translateX(5px); }
        .nav-link-custom.active { background: var(--ues-guinda); color: white; box-shadow: 0 4px 15px rgba(128,0,0,0.3); }

        /* Glass Cards */
        .glass-card { 
            background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px; padding: 40px; backdrop-filter: blur(15px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        
        .form-control { 
            background: rgba(0,0,0,0.4) !important; border: 1px solid #333 !important; 
            color: white !important; border-radius: 15px; padding: 15px; transition: 0.3s;
        }
        .form-control:focus { border-color: var(--ues-guinda) !important; box-shadow: 0 0 15px rgba(128,0,0,0.1) !important; }
        
        .btn-send { 
            background: var(--ues-guinda); color: white; border: none; padding: 18px; 
            border-radius: 18px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            transition: 0.4s; width: 100%; box-shadow: 0 10px 20px rgba(128,0,0,0.2);
        }
        .btn-send:hover { background: #a00000; transform: translateY(-3px); }

        /* Status Widget (Lo que sustituye lo verde) */
        .support-status {
            background: rgba(255,255,255,0.03); border-radius: 20px; padding: 20px;
            border-top: 3px solid var(--ues-guinda); margin-bottom: 30px;
        }
        .pulse-dot { width: 10px; height: 10px; background: #28a745; border-radius: 50%; display: inline-block; margin-right: 10px; box-shadow: 0 0 10px #28a745; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .btn-whatsapp { background: #25d366; color: white; border-radius: 15px; padding: 15px; text-decoration: none; display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.3s; }
        .btn-whatsapp:hover { background: #128c7e; transform: scale(1.02); color: white; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h4 class="fw-bold mb-5 text-white">UES <span class="text-danger">HELPER</span></h4>
        <nav>
            <a href="/home.html" class="nav-link-custom"><i class="fas fa-home me-2"></i> Inicio</a>
            <a href="/dashboard.html" class="nav-link-custom"><i class="fas fa-tasks me-2"></i> Tareas</a>
            <a href="/perfil.html" class="nav-link-custom"><i class="fas fa-user-circle me-2"></i> Mi Perfil</a>
            <a href="/seguridad.html" class="nav-link-custom"><i class="fas fa-shield-alt me-2 text-danger"></i> Seguridad</a>
            <a href="/soporte.html" class="nav-link-custom active"><i class="fas fa-headset me-2"></i> Soporte / Opini√≥n</a>
        </nav>
    </div>

    <div class="main-content">
        <div class="container-fluid" style="max-width: 1000px;">
            
            <div class="support-status d-flex justify-content-between align-items-center">
                <div>
                    <span class="d-block small text-muted fw-bold">ESTADO DEL SERVICIO</span>
                    <h5 class="m-0 fw-bold"><span class="pulse-dot"></span> Soporte T√©cnico en L√≠nea</h5>
                </div>
                <div class="text-end">
                    <span class="badge bg-dark border border-secondary text-muted">Respuesta prom: 15 min</span>
                </div>
            </div>

            <div class="row g-5">
                <div class="col-lg-7">
                    <div class="glass-card">
                        <h3 class="fw-bold text-white mb-4"><i class="fas fa-comment-alt text-danger me-2"></i> Enviar Sugerencia</h3>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="small fw-bold text-muted mb-2">NOMBRE</label>
                                <input type="text" id="sugNombre" class="form-control" placeholder="Tu nombre">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="small fw-bold text-muted mb-2">CORREO</label>
                                <input type="email" id="sugEmail" class="form-control" placeholder="estudiante@ues.mx">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="small fw-bold text-muted mb-2">CATEGOR√çA</label>
                            <select id="sugTipo" class="form-control">
                                <option value="Sugerencia">üí° Sugerencia de mejora</option>
                                <option value="Error">‚ö†Ô∏è Reportar un error (Bug)</option>
                                <option value="Opinion">üí¨ Opini√≥n general</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="small fw-bold text-muted mb-2">DESCRIPCI√ìN</label>
                            <textarea id="sugMensaje" class="form-control" rows="4" placeholder="¬øEn qu√© podemos mejorar?"></textarea>
                        </div>
                        <button onclick="enviarSugerencia()" class="btn btn-send shadow">ENVIAR COMENTARIO</button>
                    </div>
                </div>

                <div class="col-lg-5">
                    <div class="glass-card border-start border-4 border-danger mb-4">
                        <i class="fas fa-envelope-open-text text-danger fa-2x mb-3"></i>
                        <h5 class="fw-bold text-white">Correo Oficial</h5>
                        <p class="text-muted small">Para colaboraciones o dudas acad√©micas oficiales:</p>
                        <a href="mailto:FranciscoAguayo2005@gmail.com" class="text-danger fw-bold text-decoration-none">FranciscoAguayo2005@gmail.com</a>
                    </div>

                    <div class="glass-card border-start border-4 border-success">
                        <i class="fab fa-whatsapp text-success fa-2x mb-3"></i>
                        <h5 class="fw-bold text-white">WhatsApp Directo</h5>
                        <p class="text-muted small">Atenci√≥n r√°pida. Al hacer clic, el sistema sabr√° qui√©n eres.</p>
                        <button onclick="contactarSoporte()" class="btn-whatsapp w-100 border-0">
                            <i class="fab fa-whatsapp me-2"></i> CONTACTAR AHORA
                        </button>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <p class="small text-muted">UES Helper V1.2.4 - Francisco Aguayo</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const userEmail = localStorage.getItem('userEmail');

        window.onload = () => {
            if (!userEmail) window.location.href = '/index.html';
            document.getElementById('sugEmail').value = userEmail;
        };

        async function enviarSugerencia() {
            const btn = document.querySelector('.btn-send');
            const datos = {
                nombre: document.getElementById('sugNombre').value,
                email: document.getElementById('sugEmail').value,
                mensaje: `[${document.getElementById('sugTipo').value}] - ${document.getElementById('sugMensaje').value}`
            };

            if (!datos.nombre || !datos.mensaje) return alert("‚ö†Ô∏è Completa los campos requeridos.");

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ENVIANDO...';
            btn.disabled = true;

            try {
                const res = await fetch('/enviar-sugerencia', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(datos)
                });

                if (res.ok) {
                    btn.innerHTML = '¬°LISTO! <i class="fas fa-check"></i>';
                    btn.style.background = "#28a745";
                    setTimeout(() => location.reload(), 2000);
                } else {
                    alert("Error en el servidor.");
                    btn.disabled = false;
                    btn.innerHTML = 'ENVIAR COMENTARIO';
                }
            } catch (e) { alert("Error de conexi√≥n."); btn.disabled = false; }
        }

        async function contactarSoporte() {
            let nombreUsuario = "Usuario UES";

            try {
                const res = await fetch(`/obtener-usuario/${encodeURIComponent(userEmail)}`);
                const u = await res.json();
                nombreUsuario = u.nombreReal || userEmail.split('@')[0];
            } catch (e) { console.error("No se pudo obtener el nombre"); }

            const telefono = "526625374491";
            const mensaje = `Hola, mi nombre es *${nombreUsuario}*. Escribo desde UES Helper. Mi problema es el siguiente: `;
            const url = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;
            
            window.open(url, '_blank');
        }

        function cerrarSesion() { localStorage.clear(); window.location.href = '/index.html'; }
    </script>
</body>
</html>